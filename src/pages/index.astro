---
import Layout from "@/layouts/Layout.astro";
import Homepage from "@/components/vue/homepage/Homepage.vue";
// import "@/styles/global.css";
// import "@/styles/tailwind.css";
import { createLocaleI18n, type MessageSchema } from "@/i18n";
import enMessages from "@/i18n/ui/en.json";
import { DEFAULT_LANGUAGE, LANGUAGE_META } from "@config/astro/i18n";

const currentLang = DEFAULT_LANGUAGE;
const currentLangMeta = LANGUAGE_META[currentLang];
const pageScopedInitialMessages: Record<string, MessageSchema> = {
  [currentLang]: enMessages,
};

/**
 * Component Script:
 * What markdown calls frontmatter, astro refers to as Component Script.
 *
 * "The code fence is designed to guarantee that the JavaScript that you
 * write in it is "fenced in." It won't escape into your frontend
 * application, or fall into your user's hands. You can safely write code
 * here that is expensive or sensitive (like a call to your private
 * database) without worrying about it ever ending up in your user's
 * browser."
 *  @see https://docs.astro.build/en/basics/astro-components/#the-component-script
 *  @see https://astro.new/latest/frameworks/
 *
 * Import all `.md` files in `./src/pages/post/`:
 * const matches = import.meta.glob('../pages/post/*.md', { eager: true });
 *
 * Loads and initializes the requested WASM file:
 * const wasm = await WebAssembly.instantiateStreaming(fetch('/example.wasm'));
 *
 *
 * Component Props:
 * Usage: <GreetingHeadline greeting="Howdy" name="Partner" />
 *
 * const { greeting, name } = Astro.props;
 *
 * "Astro components are always rendered to static HTML, even when they include
 * framework components that are hydrated. This means that you can only pass
 * props that don't do any HTML rendering."
 *
 * Component Template:
 * "Use the Astro <slot /> pattern to pass static content generated by
 * Astro components as children to your framework components inside an
 * .astro component"
 *
 * "If you try to hydrate an Astro component with a client: modifier, you
 * will get an error."
 */

// Initialize a page-specific i18n instance for SSR content (for English)
const pageI18n = await createLocaleI18n(currentLang, pageScopedInitialMessages);
const t = pageI18n.global.t;

// Translated title and description for the Layout using English
// IMPORTANT: Ensure 'web.homepage.title' and 'web.homepage.description' keys exist in en.json
const pageTitle = t("web.homepage.title");
const pageDescription = t("web.homepage.description");

// The import "@/i18n"; was already here.
// Homepage.vue will call setLanguage('en') on the client.
---

<!-- The Component Template -->
<Layout
  title={pageTitle}
  description={pageDescription}
  htmlLang={currentLang}
  langDir={currentLangMeta.dir}
  initialMessages={pageScopedInitialMessages}>
  <!-- Render the Homepage component -->
  <!-- client:load ensures the Vue component hydrates and runs client-side -->
  <Homepage
    client:load
    locale={currentLang}
    initialMessages={pageScopedInitialMessages}
  />
  <!-- <slot />  -->
</Layout>
